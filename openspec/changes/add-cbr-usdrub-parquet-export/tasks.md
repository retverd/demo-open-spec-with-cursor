# Задачи для change `add-cbr-usdrub-parquet-export`

## 1. Спецификация

- [x] 1.1 Зафиксировать в спеках поведение на “курс за текущий день недоступен” (частичный результат, сохраняем доступные значения).
- [x] 1.2 Зафиксировать в спеках сохранение Parquet в **текущую папку** (cwd) и правило имени файла с **временем запуска**.
- [x] 1.3 Зафиксировать в спеках таймауты и retries для вызова API ЦБ РФ (таймаут ≤ 10с, retries ≤ 3 на временные ошибки).
- [x] 1.4 Зафиксировать в спеках валидацию данных перед сохранением (например, `rate` должен быть > 0).

## 2. Реализация (после одобрения proposal)

- [x] 2.1 Добавить модуль получения исторических значений USD/RUB от ЦБ РФ за диапазон \([today-6; today]\).
- [x] 2.2 Добавить таймауты и retries для вызова API ЦБ РФ (таймаут ≤ 10с, retries ≤ 3 на временные ошибки).
- [x] 2.3 Добавить валидацию полученных данных (минимум: `rate` - число и `rate` > 0; иначе ошибка и без записи файла).
- [x] 2.4 Добавить преобразование данных к табличному виду (DataFrame/Record list) и схему для Parquet.
- [x] 2.5 Добавить сохранение Parquet в **текущую папку** (cwd) с именем `cbr_usdrub_YYYY-MM-DD_HHMMSS.parquet`.
- [x] 2.6 Добавить CLI/точку входа для запуска (минимальная, локальная).
- [x] 2.7 Зафиксировать Parquet-бэкенд в зависимостях (выбрать библиотеку и версии; добавить smoke-check записи/чтения).

## 3. Тестирование (после одобрения proposal)

- [x] 3.1 Unit-тесты: парсинг/маппинг данных, вычисление диапазона дат, формирование имени файла/пути.
- [x] 3.2 Unit-тесты: повторные попытки (временная ошибка → повтор → успех) и “исчерпание retries → ошибка без записи файла”.
- [x] 3.3 Unit-тесты: валидация данных (`rate` не число или ≤0 → ошибка без записи файла).
- [x] 3.4 Интеграционные тесты: реальный вызов API ЦБ РФ и проверка, что результат сохраняется в Parquet.
- [x] 3.5 Защита от сбоев: пометить интеграционные тесты маркером (например, `integration`) и сделать их отключёнными по умолчанию (запускать отдельно по флагу/цели).

## 4. Документация и валидация

- [x] 4.1 Обновить `README.md` с краткой инструкцией запуска (локально) и описанием выходного файла.
- [x] 4.2 Прогнать `openspec validate add-cbr-usdrub-parquet-export --strict`.
